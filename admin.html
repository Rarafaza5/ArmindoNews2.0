<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover">
    <title>Admin | Verdade Jovem</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #dd0000;
            --bg: #f8fafc;
            --sidebar-bg: #0f172a;
            --text: #1e293b;
            --glass: #ffffff;
            --shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        @media (prefers-color-scheme: dark) {
            :root { --bg: #020617; --text: #f1f5f9; --glass: #1e293b; --sidebar-bg: #020617; }
            .glass-card, .stat-item, .login-card, .input, .ql-toolbar, #editor-quill { 
                background: #1e293b !important; color: white !important; border-color: #334155 !important; 
            }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background-color: var(--bg); color: var(--text); overflow-x: hidden; min-height: 100vh; }

        #login { position: fixed; inset: 0; background: var(--sidebar-bg); z-index: 20000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .login-card { background: white; padding: 2.5rem; border-radius: 28px; width: 100%; max-width: 400px; text-align: center; }

        .app-layout { display: flex; min-height: 100vh; width: 100%; }
        
        .sidebar { 
            width: 280px; min-width: 280px; background: var(--sidebar-bg); color: white; 
            padding: 2rem 1.2rem; position: sticky; top: 0; height: 100vh; display: flex; flex-direction: column; 
        }

        .nav-item { 
            display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 12px; 
            color: #94a3b8; margin-bottom: 8px; cursor: pointer; transition: 0.2s; font-weight: 600; width: 100%; 
        }
        .nav-item.active { background: var(--primary); color: white; }

        .main-content { flex-grow: 1; padding: 2.5rem; max-width: calc(100vw - 280px); }

        .editor-grid { display: grid; grid-template-columns: 1fr 350px; gap: 2rem; align-items: start; }
        .glass-card { background: var(--glass); border-radius: 24px; padding: 1.5rem; box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.05); margin-bottom: 1.5rem; }

        .input-group { margin-bottom: 1.2rem; }
        .label { display: block; font-weight: 700; margin-bottom: 6px; font-size: 0.7rem; color: #64748b; text-transform: uppercase; }
        .input { width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; outline: none; }
        
        .btn { padding: 16px; border-radius: 14px; border: none; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; }
        .btn-p { background: var(--primary); color: white; }

        .ultima-hora-toggle {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px; background: #fff1f2; border: 2px solid #fecdd3;
            border-radius: 15px; margin-bottom: 1.5rem; cursor: pointer; color: #991b1b;
        }

        .upload-area { border: 2px dashed #e2e8f0; border-radius: 16px; padding: 1.5rem; text-align: center; cursor: pointer; background: rgba(0,0,0,0.01); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-item { background: var(--glass); padding: 1.5rem; border-radius: 20px; text-align: center; box-shadow: var(--shadow); }

        .carousel-slot {
            display: flex; align-items: center; gap: 15px; padding: 15px;
            background: rgba(0,0,0,0.02); border-radius: 18px; margin-bottom: 12px;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .carousel-number {
            background: var(--primary); color: white; width: 32px; height: 32px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 0.9rem; flex-shrink: 0;
        }

        .mobile-nav { display: none; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .mobile-nav { display: flex; position: fixed; bottom: 0; left: 0; right: 0; background: var(--glass); border-top: 1px solid rgba(0,0,0,0.1); justify-content: space-around; padding: 10px 5px calc(10px + env(safe-area-inset-bottom)); z-index: 1000; }
            .m-nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; color: #94a3b8; font-size: 0.65rem; font-weight: 700; }
            .m-nav-item.active { color: var(--primary); }
            .m-nav-item span { font-size: 1.3rem; }
            .main-content { padding: 1rem; padding-bottom: 100px; max-width: 100vw; }
            .editor-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div id="toast" style="position:fixed; top:20px; right:20px; padding:15px 25px; border-radius:12px; color:white; z-index:30000; font-weight:700; display:none;"></div>

    <div id="login">
        <div class="login-card">
            <h1 style="color:var(--primary); margin-bottom: 2rem;">Admin<br>Verdade Jovem</h1>
            <input type="password" id="pass" class="input" placeholder="Palavra-passe" style="text-align: center; margin-bottom: 1rem">
            <button onclick="login()" class="btn btn-p">Aceder</button>
        </div>
    </div>

    <div id="panel" class="app-layout" style="display:none">
        <aside class="sidebar">
            <h2 style="margin-bottom: 2.5rem; color: var(--primary); padding-left: 10px;">VJ Admin</h2>
            <nav style="flex:1">
                <div class="nav-item active" onclick="showSection('dash', this)">ğŸ“Š Painel</div>
                <div class="nav-item" onclick="showSection('write', this)">âœï¸ Redigir</div>
                <div class="nav-item" onclick="showSection('manage', this)">ğŸ“° Biblioteca</div>
                <div class="nav-item" onclick="showSection('carousel', this)">ğŸï¸ Carrossel</div>
            </nav>
            <div class="nav-item" onclick="logout()" style="color:#f87171">ğŸšª Sair</div>
        </aside>

        <nav class="mobile-nav">
            <div class="m-nav-item active" id="m-nav-dash" onclick="showSection('dash', this)"><span>ğŸ“Š</span>Painel</div>
            <div class="m-nav-item" id="m-nav-write" onclick="showSection('write', this)"><span>âœï¸</span>Redigir</div>
            <div class="m-nav-item" id="m-nav-manage" onclick="showSection('manage', this)"><span>ğŸ“°</span>Biblioteca</div>
            <div class="m-nav-item" id="m-nav-carousel" onclick="showSection('carousel', this)"><span>ğŸï¸</span>Carrossel</div>
            <div class="m-nav-item" onclick="logout()"><span>ğŸšª</span>Sair</div>
        </nav>

        <main class="main-content">
            <section id="sect-dash">
                <h1 style="margin-bottom: 1.5rem">EstatÃ­sticas</h1>
                <div class="stats-grid">
                    <div class="stat-item"><h2 id="stat-total">0</h2><p>Total</p></div>
                    <div class="stat-item"><h2 id="stat-pub" style="color:#10b981">0</h2><p>Online</p></div>
                    <div class="stat-item"><h2 id="stat-uh" style="color:var(--primary)">0</h2><p>Ãšltima Hora</p></div>
                </div>
            </section>

            <section id="sect-write" style="display:none">
                <div class="editor-grid">
                    <div class="editor-left">
                        <div class="glass-card">
                            <h2 style="margin-bottom: 1.5rem">âœï¸ ConteÃºdo</h2>
                            <input type="hidden" id="post-id">
                            <div class="input-group">
                                <label class="label">TÃ­tulo</label>
                                <input type="text" id="title" class="input" placeholder="TÃ­tulo da notÃ­cia...">
                            </div>
                            <div class="input-group">
                                <label class="label">Texto</label>
                                <div id="editor-quill" style="height: 400px;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="editor-right">
                        <div class="glass-card">
                            <label class="ultima-hora-toggle">
                                <span>ğŸš¨ ÃšLTIMA HORA</span>
                                <input type="checkbox" id="is-ultima-hora" style="width:20px; height:20px; cursor:pointer">
                            </label>
                            <div class="input-group">
                                <label class="label">Autor</label>
                                <input type="text" id="author" class="input" placeholder="Nome do autor...">
                            </div>
                            <div class="input-group">
                                <label class="label">Categoria</label>
                                <select id="category" class="input">
                                    <option value="pais">ğŸ‡µğŸ‡¹ PaÃ­s</option>
                                    <option value="mundo">ğŸŒ Mundo</option>
                                    <option value="critica">âœï¸ CrÃ­tica</option>
                                    <option value="politica">ğŸ›ï¸ PolÃ­tica</option>
                                    <option value="Entrevista">ğŸ¤ Entrevista</option>
                                    <option value="desporto">âš½ Desporto</option>
                                    <option value="tecnologia">ğŸ“± Tecnologia</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label class="label">Capa</label>
                                <div class="upload-area" onclick="document.getElementById('file-input').click()">
                                    <span id="up-label">ğŸ“· Foto</span>
                                    <input type="file" id="file-input" hidden accept="image/*" onchange="processImage(this)">
                                </div>
                                <input type="hidden" id="image-data">
                                <img id="img-render" src="" style="width:100%; border-radius:10px; margin-top:10px; display:none;">
                            </div>
                            <button onclick="savePost(true)" class="btn btn-p" style="margin-bottom:10px">ğŸš€ Publicar</button>
                            <button onclick="savePost(false)" class="btn" style="background:#e2e8f0; color:#475569">ğŸ’¾ Rascunho</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="sect-manage" style="display:none">
                <h1 style="margin-bottom: 1.5rem">Biblioteca</h1>
                <div class="glass-card">
                    <input type="text" id="search" class="input" placeholder="ğŸ” Pesquisar por tÃ­tulo..." oninput="renderLibrary()" style="margin-bottom:1.5rem">
                    <div id="library-list"></div>
                </div>
            </section>

            <section id="sect-carousel" style="display:none">
                <h1 style="margin-bottom: 0.5rem">ğŸï¸ Destaques do Carrossel</h1>
                <p style="margin-bottom: 2rem; opacity: 0.7;">Escolha as notÃ­cias que ficarÃ£o fixas no topo do index.</p>
                <div class="glass-card" id="carousel-manager-content">
                    </div>
            </section>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBmaIc7aA25g5WVP_DTGHOCEtnW1ZXuyNc",
            authDomain: "aawards.firebaseapp.com",
            databaseURL: "https://aawards-default-rtdb.firebaseio.com",
            projectId: "aawards",
            storageBucket: "aawards.appspot.com",
            messagingSenderId: "839334918366",
            appId: "1:839334918366:web:81f2bbfc78fd85f046ea4f"
        };

        let db, quill, articles = [];

        function login() {
            if(document.getElementById('pass').value === "ArmindoNews2024") {
                sessionStorage.setItem('vj_in', 'ok');
                start();
            } else { showToast("Erro!", "#ef4444"); }
        }

        function start() {
            document.getElementById('login').style.display = 'none';
            document.getElementById('panel').style.display = 'flex';
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            quill = new Quill('#editor-quill', { theme: 'snow', modules: { toolbar: [[{'header': [1, 2, false]}], ['bold', 'italic', 'link'], [{'list': 'bullet'}]] }});
            
            db.ref('articles').on('value', snap => {
                const data = snap.val();
                articles = data ? Object.keys(data).map(k => ({id:k, ...data[k]})) : [];
                renderDashboard();
                renderLibrary();
                renderCarouselManager();
            });
        }

        function processImage(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const scale = 800 / img.width;
                    canvas.width = 800; canvas.height = img.height * scale;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    const base64 = canvas.toDataURL('image/jpeg', 0.7);
                    document.getElementById('image-data').value = base64;
                    document.getElementById('img-render').src = base64;
                    document.getElementById('img-render').style.display = 'block';
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function savePost(isPub) {
            const id = document.getElementById('post-id').value;
            const title = document.getElementById('title').value;
            if(!title) return showToast("TÃ­tulo obrigatÃ³rio", "#ef4444");

            const existing = id ? articles.find(a => a.id === id) : null;
            const data = {
                title: title,
                author: document.getElementById('author').value,
                category: document.getElementById('category').value,
                image: document.getElementById('image-data').value,
                content: quill.root.innerHTML,
                isUH: document.getElementById('is-ultima-hora').checked,
                carouselOrder: existing ? (existing.carouselOrder || null) : null,
                published: isPub,
                date: id ? existing.date : Date.now()
            };

            const ref = id ? db.ref('articles/'+id) : db.ref('articles').push();
            ref.set(data).then(() => {
                showToast("Sucesso!");
                clearEditor();
                showSection('manage', document.getElementById('m-nav-manage'));
            });
        }

        function renderLibrary() {
            const list = document.getElementById('library-list');
            const search = document.getElementById('search').value.toLowerCase();
            const filtered = articles.filter(a => a.title.toLowerCase().includes(search)).sort((a,b) => b.date - a.date);
            list.innerHTML = filtered.map(a => `
                <div style="display:flex; align-items:center; gap:15px; padding:12px; border-bottom:1px solid rgba(0,0,0,0.05)">
                    <img src="${a.image || 'VJ_l.webp'}" style="width:50px; height:35px; border-radius:4px; object-fit:cover">
                    <div style="flex:1">
                        <h4 style="font-size:0.85rem">${a.isUH ? 'ğŸš¨ ' : ''}${a.title}</h4>
                        <small style="opacity:0.6">${a.published ? 'ğŸŸ¢ No Ar' : 'âšª Rascunho'}</small>
                    </div>
                    <button onclick="editPost('${a.id}')" style="background:none; border:none; cursor:pointer; font-size:1.1rem">âœï¸</button>
                    <button onclick="deletePost('${a.id}')" style="background:none; border:none; cursor:pointer; font-size:1.1rem">ğŸ—‘ï¸</button>
                </div>
            `).join('');
        }

        function renderCarouselManager() {
            const container = document.getElementById('carousel-manager-content');
            const pubs = articles.filter(a => a.published);
            const inCarousel = pubs.filter(a => a.carouselOrder).sort((a,b) => a.carouselOrder - b.carouselOrder);
            const available = pubs.filter(a => !a.carouselOrder).sort((a,b) => b.date - a.date);

            let html = '<div style="margin-bottom:30px">';
            [1, 2, 3].forEach(num => {
                const active = inCarousel.find(a => a.carouselOrder == num);
                html += `
                <div class="carousel-slot">
                    <div class="carousel-number">${num}</div>
                    ${active ? `
                        <img src="${active.image}" style="width:60px; height:40px; border-radius:8px; object-fit:cover">
                        <div style="flex:1"><h4 style="font-size:0.9rem">${active.title}</h4></div>
                        <button onclick="updateCarouselOrder('${active.id}', null)" style="background:#fee2e2; color:#ef4444; border:none; padding:8px 15px; border-radius:10px; cursor:pointer; font-weight:700; font-size:0.75rem">Remover</button>
                    ` : `
                        <div style="flex:1; opacity:0.5; font-style:italic; font-size:0.9rem">Slot vazio (mostra notÃ­cia recente)</div>
                    `}
                </div>`;
            });
            html += '</div>';

            html += `
            <div style="border-top: 1px solid rgba(0,0,0,0.05); padding-top:20px">
                <h3 style="margin-bottom:15px; font-size:1rem">Substituir / Adicionar:</h3>
                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:15px">
                    ${[1, 2, 3].map(n => `
                        <div>
                            <label class="label">Para PosiÃ§Ã£o ${n}</label>
                            <select class="input" onchange="if(this.value) updateCarouselOrder(this.value, ${n})">
                                <option value="">Selecionar notÃ­cia...</option>
                                ${available.map(a => `<option value="${a.id}">${a.title}</option>`).join('')}
                            </select>
                        </div>
                    `).join('')}
                </div>
            </div>`;

            container.innerHTML = html;
        }

        function updateCarouselOrder(id, pos) {
            if(pos !== null) {
                const old = articles.find(a => a.carouselOrder == pos);
                if(old) db.ref('articles/'+old.id+'/carouselOrder').set(null);
            }
            db.ref('articles/'+id+'/carouselOrder').set(pos).then(() => showToast("Carrossel atualizado!"));
        }

        function editPost(id) {
            const a = articles.find(x => x.id === id);
            document.getElementById('post-id').value = id;
            document.getElementById('title').value = a.title;
            document.getElementById('author').value = a.author || "";
            document.getElementById('category').value = a.category;
            document.getElementById('is-ultima-hora').checked = a.isUH || false;
            document.getElementById('image-data').value = a.image || '';
            document.getElementById('img-render').src = a.image || '';
            document.getElementById('img-render').style.display = a.image ? 'block' : 'none';
            quill.root.innerHTML = a.content;
            showSection('write', document.getElementById('m-nav-write'));
        }

        function deletePost(id) { if(confirm("Apagar definitivamente?")) db.ref('articles/'+id).remove(); }

        function renderDashboard() {
            document.getElementById('stat-total').innerText = articles.length;
            document.getElementById('stat-pub').innerText = articles.filter(a=>a.published).length;
            document.getElementById('stat-uh').innerText = articles.filter(a=>a.isUH).length;
        }

        function showSection(name, el) {
            document.querySelectorAll('section').forEach(s => s.style.display = 'none');
            document.getElementById('sect-'+name).style.display = 'block';
            document.querySelectorAll('.nav-item, .m-nav-item').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');
            const mobEl = document.getElementById('m-nav-'+name);
            if(mobEl) mobEl.classList.add('active');
        }

        function clearEditor() {
            document.getElementById('post-id').value = "";
            document.getElementById('title').value = "";
            document.getElementById('author').value = "";
            document.getElementById('image-data').value = "";
            document.getElementById('is-ultima-hora').checked = false;
            document.getElementById('img-render').style.display = 'none';
            quill.root.innerHTML = "";
        }

        function showToast(msg, color = '#10b981') {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.background = color; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 3000);
        }

        function logout() { sessionStorage.clear(); location.reload(); }
        if(sessionStorage.getItem('vj_in')) start();
    </script>
</body>
</html>