<!DOCTYPE html>
<html lang="pt-br">
<head>
    <link rel="icon" type="image/x-icon" href="an.png">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8653418731294447"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Armindo News - Admin</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @font-face {
            font-family: 'an';
            src: url('/EnglishTowne.woff') format('woff');
            font-weight: bold;
            font-display: swap;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5a6fd8;
            --secondary: #764ba2;
            --accent: #f093fb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --border: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .topbar {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem;
            box-shadow: var(--shadow);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .topbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 2rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'an', sans-serif;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .main-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            margin-top: 70px;
            min-height: calc(100vh - 70px);
        }

        .sidebar {
            background: white;
            box-shadow: var(--shadow);
            padding: 1rem 0;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-item {
            margin-bottom: 0.25rem;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            color: var(--gray);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            border-right: 3px solid transparent;
        }

        .sidebar-link:hover, .sidebar-link.active {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.1), transparent);
            color: var(--primary);
            border-right-color: var(--primary);
        }

        .sidebar-icon {
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        .content-area {
            padding: 1.5rem;
            overflow-y: auto;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-subtitle {
            color: var(--gray);
            font-size: 1rem;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .card-header {
            padding: 1.5rem 1.5rem 1rem;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            white-space: nowrap;
            min-height: 44px; /* Touch-friendly */
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
            min-height: 44px; /* Touch-friendly */
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .editor-container {
            border: 2px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .editor-container .ql-toolbar {
            border: none;
            border-bottom: 1px solid var(--border);
        }

        .editor-container .ql-container {
            border: none;
            font-family: inherit;
            font-size: 1rem;
            min-height: 300px;
        }

        .image-upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 2rem 1rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .image-upload-area:hover {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.05);
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .youtube-preview {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
        }

        .youtube-preview iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 1rem;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            background: none;
            border: none;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 90px;
            right: 1rem;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 3000;
            max-width: calc(100vw - 2rem);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.warning {
            border-left: 4px solid var(--warning);
        }

        .article-list {
            list-style: none;
        }

        .article-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            transition: background 0.3s ease;
        }

        .article-item:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .article-thumbnail {
            width: 60px;
            height: 45px;
            object-fit: cover;
            border-radius: 6px;
            flex-shrink: 0;
        }

        .article-info {
            flex: 1;
            min-width: 0;
        }

        .article-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.3rem;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .article-meta {
            font-size: 0.8rem;
            color: var(--gray);
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
        }

        .article-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .status-badge {
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-published {
            background: #d1fae5;
            color: #065f46;
        }

        .status-draft {
            background: #fef3c7;
            color: #92400e;
        }

        .status-featured {
            background: #fbbf24;
            color: #92400e;
        }

        .status-carousel {
            background: #a855f7;
            color: white;
        }

        .highlight-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            background: #f8fafc;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .highlight-options label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .highlight-options label:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .highlight-options input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin: 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }

        .stat-card {
            text-align: center;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 8px;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 900;
            color: var(--primary);
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                margin-top: 60px;
            }
            
            .topbar {
                padding: 0.75rem 1rem;
            }

            .logo {
                font-size: 1.2rem;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .sidebar {
                position: fixed;
                left: 0;
                top: 60px;
                height: calc(100vh - 60px);
                width: 280px;
                transform: translateX(-100%);
                z-index: 999;
                background: white;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .content-area {
                padding: 1rem;
                width: 100%;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .card-header,
            .card-body {
                padding: 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .article-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 1rem;
            }

            .article-thumbnail {
                width: 80px;
                height: 60px;
            }

            .article-actions {
                width: 100%;
                justify-content: flex-start;
            }

            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
                flex: 1;
                min-width: auto;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons .btn {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }

            .stat-card {
                padding: 1rem;
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .highlight-options {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .modal-content {
                margin: 1rem;
                padding: 1.5rem;
                max-width: none;
            }

            .editor-container .ql-container {
                min-height: 250px;
            }

            .image-upload-area {
                padding: 1.5rem 1rem;
                min-height: 100px;
            }

            .toast {
                right: 0.5rem;
                left: 0.5rem;
                max-width: none;
            }
        }

        /* Small mobile devices */
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .article-actions {
                flex-direction: column;
            }

            .article-actions .btn {
                width: 100%;
            }

            .form-input,
            .form-textarea,
            .form-select {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }

        /* Overlay for mobile menu */
        .mobile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 998;
            display: none;
        }

        .mobile-overlay.show {
            display: block;
        }

        /* Better touch targets */
        @media (max-width: 768px) {
            .sidebar-link {
                padding: 1.25rem 1.5rem;
                font-size: 1rem;
            }

            .sidebar-icon {
                font-size: 1.2rem;
            }
        }

        /* Loading states */
        .btn.loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .btn.loading::after {
            content: '';
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay" onclick="closeMobileMenu()"></div>

    <!-- Topbar -->
    <div class="topbar">
        <div class="topbar-content">
            <div class="logo">
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">☰</button>
                Armindo News - Admin
            </div>
            <div class="user-menu">
                <button class="btn btn-danger" onclick="logout()">
                    🚪 Sair
                </button>
            </div>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="modal" style="display: flex;">
        <div class="modal-content">
            <h2 style="text-align: center; margin-bottom: 2rem;">🔐 Login Administrativo</h2>
            <div class="form-group">
                <label class="form-label">Senha de Administrador</label>
                <input type="password" id="admin-password" class="form-input" placeholder="Digite sua senha...">
            </div>
            <button class="btn btn-primary" onclick="login()" style="width: 100%;">
                🚀 Acessar Painel
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container" id="main-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link active" onclick="showSection('dashboard')">
                        <span class="sidebar-icon">📊</span>
                        Dashboard
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link" onclick="showSection('articles')">
                        <span class="sidebar-icon">📄</span>
                        Artigos
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link" onclick="showSection('carousel')">
                        <span class="sidebar-icon">🎠</span>
                        Carrossel
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link" onclick="showSection('editor')">
                        <span class="sidebar-icon">✏️</span>
                        Editor Avançado
                    </a>
                </li>
            </ul>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Visão geral completa do seu portal de notícias</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">📈 Estatísticas Rápidas</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="total-articles">0</div>
                                <div class="stat-label">Total de Artigos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="published-articles">0</div>
                                <div class="stat-label">Publicados</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="draft-articles">0</div>
                                <div class="stat-label">Rascunhos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="carousel-articles">0</div>
                                <div class="stat-label">No Carrossel</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Carousel Management Section -->
            <div id="carousel-section" class="section hidden">
                <div class="page-header">
                    <h1 class="page-title">Gerenciar Carrossel</h1>
                    <p class="page-subtitle">Configure os artigos que aparecem no carrossel da página principal</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">🎠 Artigos no Carrossel</h3>
                        <p style="color: var(--gray); margin-top: 0.5rem;">Máximo de 5 artigos podem aparecer no carrossel</p>
                    </div>
                    <div class="card-body">
                        <div id="carousel-articles-list">
                            <div class="loading">
                                <div class="spinner"></div>
                                Carregando artigos do carrossel...
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">➕ Adicionar ao Carrossel</h3>
                    </div>
                    <div class="card-body">
                        <div id="available-articles-list">
                            <div class="loading">
                                <div class="spinner"></div>
                                Carregando artigos disponíveis...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Articles Management Section -->
            <div id="articles-section" class="section hidden">
                <div class="page-header">
                    <h1 class="page-title">Gestão de Artigos</h1>
                    <p class="page-subtitle">Gerencie todos os seus artigos de forma profissional</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                            <h3 class="card-title">📚 Biblioteca de Artigos</h3>
                            <button class="btn btn-primary" onclick="showSection('editor')">
                                ➕ Novo Artigo
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="articles-table">
                            <div class="loading">
                                <div class="spinner"></div>
                                Carregando artigos...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Editor Section -->
            <div id="editor-section" class="section hidden">
                <div class="page-header">
                    <h1 class="page-title">Editor Avançado</h1>
                    <p class="page-subtitle">Crie conteúdo profissional com nosso editor visual</p>
                </div>

                <form id="article-form">
                    <input type="hidden" id="edit-id">
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">🏷️ Título do Artigo</label>
                            <input type="text" id="article-title" class="form-input" placeholder="Digite um título cativante..." maxlength="100">
                        </div>
                        <div class="form-group">
                            <label class="form-label">📂 Categoria</label>
                            <select id="article-category" class="form-select">
                                <option value="breaking">🚨 Breaking News</option>
                                <option value="critica">✏️ Critica</option>
                                <option value="mundo">🌍 Mundo</option>
                                <option value="politica">🏛️ Política</option>
                                <option value="Entrevista">🎤 Entrevista</option>
                                <option value="edicaoAN">📰 Edição AN</option>
                                <option value="entretenimento">🎬 Entretenimento</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">📄 Resumo Executivo</label>
                        <textarea id="article-summary" class="form-textarea" placeholder="Escreva um resumo atrativo do seu artigo..." maxlength="300"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">🖼️ Imagem Principal</label>
                        <div class="image-upload-area" onclick="document.getElementById('image-input').click()">
                            <input type="file" id="image-input" style="display: none;" accept="image/*" onchange="handleImageUpload(this)">
                            <div>📸 Clique para fazer upload ou arraste uma imagem</div>
                            <img id="image-preview" class="image-preview" style="display: none;">
                        </div>
                        <input type="url" id="article-image-url" class="form-input" placeholder="Ou cole a URL de uma imagem..." style="margin-top: 1rem;" onchange="previewImageUrl()">
                    </div>

                    <div class="form-group">
                        <label class="form-label">🎥 Vídeo do YouTube (Entrevistas)</label>
                        <input type="url" id="article-youtube-url" class="form-input" placeholder="Cole a URL do YouTube aqui (ex: https://www.youtube.com/watch?v=...)" onchange="previewYouTubeEmbed()">
                        <div id="youtube-preview" class="youtube-preview" style="display: none; margin-top: 1rem; border: 2px solid var(--border); border-radius: 8px; overflow: hidden;">
                            <iframe id="youtube-iframe" width="100%" height="315" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <small style="color: var(--gray); margin-top: 0.5rem; display: block;">
                            ℹ️ Ideal para entrevistas em vídeo. O vídeo aparecerá no artigo publicado.
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">📝 Conteúdo do Artigo</label>
                        <div class="editor-container">
                            <div id="quill-editor" style="height: 400px;"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">👤 Autor</label>
                        <input type="text" id="article-author" class="form-input" placeholder="Nome do autor" value="Admin">
                    </div>

                    <!-- Highlight Options -->
                    <div class="highlight-options">
                        <label>
                            <input type="checkbox" id="article-published">
                            📢 Publicar Imediatamente
                        </label>
                        <label>
                            <input type="checkbox" id="article-carousel">
                            🎠 Destacar no Carrossel
                        </label>
                        <label>
                            <input type="checkbox" id="article-breaking">
                            🚨 Breaking News
                        </label>
                    </div>

                    <div class="action-buttons">
                        <button type="button" class="btn btn-success" onclick="saveArticle()">
                            💾 Salvar Artigo
                        </button>
                        <button type="button" class="btn btn-warning" onclick="saveDraft()">
                            📝 Salvar Rascunho
                        </button>
                        <button type="button" class="btn btn-danger" onclick="resetForm()" style="background: var(--gray);">
                            🔄 Limpar Formulário
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast"></div>

    <script>
        // Firebase Configuration
       const firebaseConfig = {
  apiKey: "%%GOOGLE_API%%",
  authDomain: "aawards.firebaseapp.com",
  databaseURL: "https://aawards-default-rtdb.firebaseio.com",
  projectId: "aawards",
  storageBucket: "aawards.firebasestorage.app",
  messagingSenderId: "839334918366",
  appId: "1:839334918366:web:454a259fa3e2665b46ea4f",
  measurementId: "G-NLLMB9THVX"
};

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const articlesRef = database.ref('articles');

        // Global Variables
        let allArticles = [];
        let quillEditor;
        const ADMIN_PASSWORD = "%%ADMIN_PASS%%";

        // Mobile Menu Functions
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            
            sidebar.classList.toggle('show');
            overlay.classList.toggle('show');
            
            // Prevent body scrolling when menu is open
            document.body.style.overflow = sidebar.classList.contains('show') ? 'hidden' : '';
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            
            sidebar.classList.remove('show');
            overlay.classList.remove('show');
            document.body.style.overflow = '';
        }

        // Initialize Quill Editor with mobile-friendly settings
        function initQuillEditor() {
            const isMobile = window.innerWidth <= 768;
            
            const toolbarOptions = [
                ['bold', 'italic', 'underline'],
                ['blockquote', { 'header': 1 }, { 'header': 2 }],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                ['link', 'image'],
                ['clean']
            ];

            // Simplified toolbar for mobile
            if (isMobile) {
                toolbarOptions.splice(1, 1); // Remove some options on mobile
            }

            quillEditor = new Quill('#quill-editor', {
                modules: {
                    toolbar: toolbarOptions
                },
                theme: 'snow',
                placeholder: 'Escreva seu artigo aqui...'
            });

            // Better mobile experience for editor
            if (isMobile) {
                document.querySelector('.ql-editor').style.minHeight = '250px';
            }
        }

        // Authentication with improved error handling
        function login() {
            const passwordInput = document.getElementById('admin-password');
            const loginButton = event.target;
            const password = passwordInput.value.trim();
            
            if (!password) {
                showToast('Por favor, digite a senha!', 'error');
                passwordInput.focus();
                return;
            }

            // Add loading state
            loginButton.classList.add('loading');
            loginButton.disabled = true;

            // Simulate network delay for better UX
            setTimeout(() => {
                if (password === ADMIN_PASSWORD) {
                    document.getElementById('login-screen').style.display = 'none';
                    document.getElementById('main-container').style.display = 'grid';
                    showToast('Login realizado com sucesso!', 'success');
                    loadDashboard();
                    initQuillEditor();
                } else {
                    showToast('Senha incorreta! Tente novamente.', 'error');
                    passwordInput.value = '';
                    passwordInput.focus();
                }
                
                loginButton.classList.remove('loading');
                loginButton.disabled = false;
            }, 500);
        }

        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('main-container').style.display = 'none';
                document.getElementById('admin-password').value = '';
                showToast('Logout realizado com sucesso!', 'success');
                
                // Clear any cached data
                allArticles = [];
                if (quillEditor) {
                    quillEditor.setText('');
                }
                resetForm();
            }
        }

        // Enhanced Navigation with mobile support
        function showSection(sectionName) {
            // Close mobile menu when navigating
            closeMobileMenu();
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });

            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active');
            });

            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Find and activate the clicked link
            const clickedLink = event.target.closest('.sidebar-link');
            if (clickedLink) {
                clickedLink.classList.add('active');
            }

            // Scroll to top on section change (mobile)
            if (window.innerWidth <= 768) {
                document.querySelector('.content-area').scrollTop = 0;
            }

            switch(sectionName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'articles':
                    loadArticlesTable();
                    break;
                case 'carousel':
                    loadCarouselManagement();
                    break;
                case 'editor':
                    if (!quillEditor) initQuillEditor();
                    break;
            }
        }

        // Dashboard Functions with error handling
        function loadDashboard() {
            const statsElements = {
                total: document.getElementById('total-articles'),
                published: document.getElementById('published-articles'),
                drafts: document.getElementById('draft-articles'),
                carousel: document.getElementById('carousel-articles')
            };

            // Show loading state
            Object.values(statsElements).forEach(el => {
                if (el) el.textContent = '...';
            });

            articlesRef.once('value', (snapshot) => {
                try {
                    const articles = [];
                    snapshot.forEach((childSnapshot) => {
                        const article = childSnapshot.val();
                        if (article) {
                            article.id = childSnapshot.key;
                            articles.push(article);
                        }
                    });

                    allArticles = articles;
                    updateDashboardStats(articles);
                } catch (error) {
                    console.error('Error loading dashboard:', error);
                    showToast('Erro ao carregar dashboard!', 'error');
                    
                    // Reset stats to 0 on error
                    Object.values(statsElements).forEach(el => {
                        if (el) el.textContent = '0';
                    });
                }
            }).catch(error => {
                console.error('Firebase error:', error);
                showToast('Erro de conexão com o banco de dados!', 'error');
            });
        }

        function updateDashboardStats(articles) {
            try {
                const published = articles.filter(a => a.published);
                const drafts = articles.filter(a => !a.published);
                const carouselItems = articles.filter(a => a.carousel && a.published);

                const updates = [
                    { id: 'total-articles', value: articles.length },
                    { id: 'published-articles', value: published.length },
                    { id: 'draft-articles', value: drafts.length },
                    { id: 'carousel-articles', value: carouselItems.length }
                ];

                updates.forEach(({ id, value }) => {
                    const element = document.getElementById(id);
                    if (element) {
                        // Animate number change
                        animateNumber(element, parseInt(element.textContent) || 0, value);
                    }
                });
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        // Number animation for stats
        function animateNumber(element, start, end, duration = 1000) {
            const range = end - start;
            const startTime = Date.now();
            
            function updateNumber() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = Math.round(start + (range * progress));
                
                element.textContent = current;
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            updateNumber();
        }

        // Enhanced Carousel Management
        function loadCarouselManagement() {
            const carouselContainer = document.getElementById('carousel-articles-list');
            const availableContainer = document.getElementById('available-articles-list');
            
            // Show loading states
            carouselContainer.innerHTML = '<div class="loading"><div class="spinner"></div>Carregando carrossel...</div>';
            availableContainer.innerHTML = '<div class="loading"><div class="spinner"></div>Carregando artigos...</div>';

            articlesRef.orderByChild('date').once('value', (snapshot) => {
                try {
                    const articles = [];
                    snapshot.forEach((childSnapshot) => {
                        const article = childSnapshot.val();
                        if (article) {
                            article.id = childSnapshot.key;
                            articles.unshift(article); // Most recent first
                        }
                    });

                    const carouselArticles = articles.filter(a => a.carousel && a.published);
                    const availableArticles = articles.filter(a => !a.carousel && a.published);

                    displayCarouselArticles(carouselArticles);
                    displayAvailableArticles(availableArticles);
                } catch (error) {
                    console.error('Error loading carousel:', error);
                    carouselContainer.innerHTML = '<p style="text-align: center; color: var(--danger); padding: 2rem;">Erro ao carregar carrossel</p>';
                    availableContainer.innerHTML = '<p style="text-align: center; color: var(--danger); padding: 2rem;">Erro ao carregar artigos</p>';
                }
            }).catch(error => {
                console.error('Firebase error:', error);
                showToast('Erro ao carregar dados do carrossel!', 'error');
            });
        }

        function displayCarouselArticles(articles) {
            const container = document.getElementById('carousel-articles-list');
            
            if (articles.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 2rem;">Nenhum artigo no carrossel</p>';
                return;
            }

            container.innerHTML = articles.map((article, index) => `
                <div class="article-item">
                    <div style="font-weight: 900; color: var(--primary); min-width: 30px; text-align: center;">${index + 1}</div>
                    <img src="${article.image || 'https://via.placeholder.com/80x60/667eea/ffffff?text=IMG'}" 
                         alt="${escapeHtml(article.title)}" class="article-thumbnail" loading="lazy">
                    <div class="article-info">
                        <div class="article-title">${escapeHtml(article.title)}</div>
                        <div class="article-meta">
                            ${formatDate(article.date)} • 
                            ${escapeHtml(article.author || 'Admin')} • 
                            ${escapeHtml(getCategoryName(article.category))}
                            ${article.youtubeUrl ? '<span class="status-badge" style="background: #ff0000; color: white;">🎥 Vídeo</span>' : ''}
                            <span class="status-badge status-carousel">🎠 Carrossel</span>
                        </div>
                    </div>
                    <div class="article-actions">
                        <button class="btn btn-warning" onclick="removeFromCarousel('${article.id}')">
                            ❌ Remover
                        </button>
                        <button class="btn btn-primary" onclick="editArticle('${article.id}')">
                            ✏️ Editar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function displayAvailableArticles(articles) {
            const container = document.getElementById('available-articles-list');
            
            if (articles.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 2rem;">Todos os artigos publicados já estão no carrossel</p>';
                return;
            }

            const displayArticles = articles.slice(0, 20); // Limit for performance
            
            container.innerHTML = displayArticles.map(article => `
                <div class="article-item">
                    <img src="${article.image || 'https://via.placeholder.com/80x60/667eea/ffffff?text=IMG'}" 
                         alt="${escapeHtml(article.title)}" class="article-thumbnail" loading="lazy">
                    <div class="article-info">
                        <div class="article-title">${escapeHtml(article.title)}</div>
                        <div class="article-meta">
                            ${formatDate(article.date)} • 
                            ${escapeHtml(article.author || 'Admin')} • 
                            ${escapeHtml(getCategoryName(article.category))}
                            ${article.youtubeUrl ? '<span class="status-badge" style="background: #ff0000; color: white;">🎥 Vídeo</span>' : ''}
                            <span class="status-badge status-published">📢 Publicado</span>
                        </div>
                    </div>
                    <div class="article-actions">
                        <button class="btn btn-success" onclick="addToCarousel('${article.id}')" 
                                style="background: var(--info);">
                            🎠 Adicionar
                        </button>
                    </div>
                </div>
            `).join('');

            if (articles.length > 20) {
                container.innerHTML += `<p style="text-align: center; color: var(--gray); padding: 1rem;">Mostrando 20 de ${articles.length} artigos disponíveis</p>`;
            }
        }

        function addToCarousel(articleId) {
            const button = event.target;
            button.classList.add('loading');
            button.disabled = true;
            
            // Check carousel limit
            articlesRef.orderByChild('carousel').equalTo(true).once('value', (snapshot) => {
                const carouselCount = snapshot.numChildren();
                
                if (carouselCount >= 5) {
                    showToast('Máximo de 5 artigos permitidos no carrossel!', 'error');
                    button.classList.remove('loading');
                    button.disabled = false;
                    return;
                }

                articlesRef.child(articleId).update({ 
                    carousel: true,
                    lastModified: Date.now()
                }).then(() => {
                    showToast('Artigo adicionado ao carrossel!', 'success');
                    loadCarouselManagement();
                }).catch(error => {
                    console.error('Error adding to carousel:', error);
                    showToast('Erro ao adicionar ao carrossel!', 'error');
                    button.classList.remove('loading');
                    button.disabled = false;
                });
            });
        }

        function removeFromCarousel(articleId) {
            if (!confirm('Remover este artigo do carrossel?')) return;
            
            const button = event.target;
            button.classList.add('loading');
            button.disabled = true;
            
            articlesRef.child(articleId).update({ 
                carousel: false,
                lastModified: Date.now()
            }).then(() => {
                showToast('Artigo removido do carrossel!', 'success');
                loadCarouselManagement();
            }).catch(error => {
                console.error('Error removing from carousel:', error);
                showToast('Erro ao remover do carrossel!', 'error');
                button.classList.remove('loading');
                button.disabled = false;
            });
        }

        // Enhanced Articles Management
        function loadArticlesTable() {
            const tableContainer = document.getElementById('articles-table');
            tableContainer.innerHTML = '<div class="loading"><div class="spinner"></div>Carregando artigos...</div>';
            
            articlesRef.orderByChild('date').once('value', (snapshot) => {
                try {
                    const articles = [];
                    snapshot.forEach((childSnapshot) => {
                        const article = childSnapshot.val();
                        if (article) {
                            article.id = childSnapshot.key;
                            articles.unshift(article);
                        }
                    });

                    if (articles.length === 0) {
                        tableContainer.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 2rem;">Nenhum artigo encontrado. <button class="btn btn-primary" onclick="showSection(\'editor\')">Criar primeiro artigo</button></p>';
                        return;
                    }

                    tableContainer.innerHTML = articles.map(article => `
                        <div class="article-item">
                            <img src="${article.image || 'https://via.placeholder.com/80x60/667eea/ffffff?text=IMG'}" 
                                 alt="${escapeHtml(article.title)}" class="article-thumbnail" loading="lazy">
                            <div class="article-info">
                                <div class="article-title">${escapeHtml(article.title)}</div>
                                <div class="article-meta">
                                    ${formatDate(article.date)} • 
                                    ${escapeHtml(article.author || 'Admin')} • 
                                    ${escapeHtml(getCategoryName(article.category))}
                                    <span class="status-badge ${article.published ? 'status-published' : 'status-draft'}">
                                        ${article.published ? '📢 Publicado' : '📝 Rascunho'}
                                    </span>
                                    ${article.youtubeUrl ? '<span class="status-badge" style="background: #ff0000; color: white;">🎥 Vídeo</span>' : ''}
                                    ${article.carousel ? '<span class="status-badge status-carousel">🎠 Carrossel</span>' : ''}
                                    ${article.breaking ? '<span class="status-badge" style="background: #ef4444; color: white;">🚨 Breaking</span>' : ''}
                                </div>
                            </div>
                            <div class="article-actions">
                                <button class="btn btn-primary" onclick="editArticle('${article.id}')">✏️ Editar</button>
                                <button class="btn btn-${article.published ? 'warning' : 'success'}" onclick="togglePublish('${article.id}', ${!article.published})">
                                    ${article.published ? '📝 Despublicar' : '📢 Publicar'}
                                </button>
                                <button class="btn btn-danger" onclick="deleteArticle('${article.id}')">🗑️ Excluir</button>
                            </div>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Error loading articles:', error);
                    tableContainer.innerHTML = '<p style="text-align: center; color: var(--danger); padding: 2rem;">Erro ao carregar artigos</p>';
                }
            }).catch(error => {
                console.error('Firebase error:', error);
                showToast('Erro ao carregar artigos!', 'error');
            });
        }

        // Enhanced Image Handling
        function handleImageUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                showToast('Por favor, selecione apenas arquivos de imagem!', 'error');
                return;
            }
            
            // Validate file size (5MB limit)
            if (file.size > 5 * 1024 * 1024) {
                showToast('Imagem muito grande! Máximo 5MB.', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('image-preview');
                preview.src = e.target.result;
                preview.style.display = 'block';
                
                // Clear URL input when uploading file
                document.getElementById('article-image-url').value = '';
            };
            reader.onerror = function() {
                showToast('Erro ao carregar imagem!', 'error');
            };
            reader.readAsDataURL(file);
        }

        function previewImageUrl() {
            const url = document.getElementById('article-image-url').value.trim();
            if (!url) return;
            
            // Basic URL validation
            try {
                new URL(url);
            } catch {
                showToast('URL de imagem inválida!', 'error');
                return;
            }
            
            const preview = document.getElementById('image-preview');
            preview.onload = () => {
                preview.style.display = 'block';
                // Clear file input when using URL
                document.getElementById('image-input').value = '';
            };
            preview.onerror = () => {
                showToast('Não foi possível carregar a imagem desta URL!', 'error');
                preview.style.display = 'none';
            };
            preview.src = url;
        }

        function previewYouTubeEmbed() {
            const url = document.getElementById('article-youtube-url').value.trim();
            const preview = document.getElementById('youtube-preview');
            const iframe = document.getElementById('youtube-iframe');
            
            if (!url) {
                preview.style.display = 'none';
                return;
            }
            
            const embedUrl = convertYouTubeToEmbed(url);
            if (embedUrl) {
                iframe.src = embedUrl;
                preview.style.display = 'block';
                showToast('Vídeo do YouTube carregado!', 'success');
            } else {
                preview.style.display = 'none';
                showToast('URL do YouTube inválida! Use formato: https://www.youtube.com/watch?v=...', 'error');
            }
        }

        function convertYouTubeToEmbed(url) {
            try {
                const urlObj = new URL(url);
                
                // Handle different YouTube URL formats
                if (urlObj.hostname === 'www.youtube.com' || urlObj.hostname === 'youtube.com') {
                    const videoId = urlObj.searchParams.get('v');
                    if (videoId) {
                        return `https://www.youtube.com/embed/${videoId}`;
                    }
                } else if (urlObj.hostname === 'youtu.be') {
                    const videoId = urlObj.pathname.substring(1);
                    if (videoId) {
                        return `https://www.youtube.com/embed/${videoId}`;
                    }
                } else if (urlObj.pathname.includes('/embed/')) {
                    // Already an embed URL
                    return url;
                }
                
                return null;
            } catch (error) {
                return null;
            }
        }

        function getYouTubeVideoId(url) {
            if (!url) return null;
            
            try {
                const urlObj = new URL(url);
                
                if (urlObj.hostname === 'www.youtube.com' || urlObj.hostname === 'youtube.com') {
                    return urlObj.searchParams.get('v');
                } else if (urlObj.hostname === 'youtu.be') {
                    return urlObj.pathname.substring(1);
                } else if (urlObj.pathname.includes('/embed/')) {
                    return urlObj.pathname.split('/embed/')[1];
                }
                
                return null;
            } catch (error) {
                return null;
            }
        }

        // Enhanced Article Operations
        function saveArticle() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            try {
                const articleData = gatherArticleData();
                
                // Validation
                const validation = validateArticleData(articleData);
                if (!validation.isValid) {
                    showToast(validation.message, 'error');
                    return;
                }

                button.classList.add('loading');
                button.disabled = true;

                const editId = document.getElementById('edit-id').value;

                const savePromise = editId ? 
                    articlesRef.child(editId).update(articleData) :
                    articlesRef.push({ ...articleData, date: Date.now() });

                savePromise.then(() => {
                    const message = editId ? 'Artigo atualizado com sucesso!' : 'Artigo criado com sucesso!';
                    showToast(message, 'success');
                    
                    if (!editId) {
                        resetForm();
                    }
                    
                    // Refresh dashboard stats
                    loadDashboard();
                }).catch(error => {
                    console.error('Error saving article:', error);
                    showToast('Erro ao salvar artigo!', 'error');
                }).finally(() => {
                    button.classList.remove('loading');
                    button.disabled = false;
                });
            } catch (error) {
                console.error('Error in saveArticle:', error);
                showToast('Erro inesperado ao salvar!', 'error');
            }
        }

        function saveDraft() {
            const publishedCheckbox = document.getElementById('article-published');
            const wasChecked = publishedCheckbox.checked;
            
            publishedCheckbox.checked = false;
            saveArticle();
            
            // Restore original state after save
            setTimeout(() => {
                publishedCheckbox.checked = wasChecked;
            }, 100);
        }

        function validateArticleData(data) {
            return { isValid: true };
        }

        function gatherArticleData() {
            const imagePreview = document.getElementById('image-preview');
            const imageUrl = document.getElementById('article-image-url').value.trim();
            const youtubeUrl = document.getElementById('article-youtube-url').value.trim();
            
            return {
                title: document.getElementById('article-title').value.trim(),
                summary: document.getElementById('article-summary').value.trim(),
                content: quillEditor.root.innerHTML,
                contentText: quillEditor.getText().trim(),
                image: imageUrl || (imagePreview.style.display !== 'none' ? imagePreview.src : ''),
                youtubeUrl: youtubeUrl,
                youtubeEmbedId: getYouTubeVideoId(youtubeUrl),
                category: document.getElementById('article-category').value,
                author: document.getElementById('article-author').value.trim() || 'Admin',
                published: document.getElementById('article-published').checked,
                carousel: document.getElementById('article-carousel').checked,
                breaking: document.getElementById('article-breaking').checked,
                lastModified: Date.now()
            };
        }

        function editArticle(articleId) {
            articlesRef.child(articleId).once('value', (snapshot) => {
                const article = snapshot.val();
                if (article) {
                    populateForm(article);
                    document.getElementById('edit-id').value = articleId;
                    showSection('editor');
                } else {
                    showToast('Artigo não encontrado!', 'error');
                }
            }).catch(error => {
                console.error('Error loading article for edit:', error);
                showToast('Erro ao carregar artigo para edição!', 'error');
            });
        }

        function populateForm(article) {
            try {
                document.getElementById('article-title').value = article.title || '';
                document.getElementById('article-summary').value = article.summary || '';
                document.getElementById('article-image-url').value = article.image || '';
                document.getElementById('article-youtube-url').value = article.youtubeUrl || '';
                document.getElementById('article-category').value = article.category || 'breaking';
                document.getElementById('article-author').value = article.author || 'Admin';
                
                if (article.image) {
                    const preview = document.getElementById('image-preview');
                    preview.src = article.image;
                    preview.style.display = 'block';
                }

                if (article.youtubeUrl) {
                    previewYouTubeEmbed();
                }

                if (quillEditor) {
                    quillEditor.root.innerHTML = article.content || '';
                }

                document.getElementById('article-published').checked = article.published || false;
                document.getElementById('article-carousel').checked = article.carousel || false;
                document.getElementById('article-breaking').checked = article.breaking || false;
            } catch (error) {
                console.error('Error populating form:', error);
                showToast('Erro ao carregar dados do artigo!', 'error');
            }
        }

        function resetForm() {
            try {
                document.getElementById('article-form').reset();
                document.getElementById('edit-id').value = '';
                document.getElementById('image-preview').style.display = 'none';
                document.getElementById('youtube-preview').style.display = 'none';
                document.getElementById('article-author').value = 'Admin';
                
                if (quillEditor) {
                    quillEditor.setText('');
                }
                
                showToast('Formulário limpo!', 'success');
            } catch (error) {
                console.error('Error resetting form:', error);
            }
        }

        function togglePublish(articleId, publish) {
            const button = event.target;
            button.classList.add('loading');
            button.disabled = true;
            
            articlesRef.child(articleId).update({ 
                published: publish,
                lastModified: Date.now()
            }).then(() => {
                showToast(`Artigo ${publish ? 'publicado' : 'despublicado'} com sucesso!`, 'success');
                loadArticlesTable();
                loadDashboard();
            }).catch(error => {
                console.error('Error toggling publish:', error);
                showToast('Erro ao alterar status de publicação!', 'error');
                button.classList.remove('loading');
                button.disabled = false;
            });
        }

        function deleteArticle(articleId) {
            if (!confirm('Tem certeza que deseja excluir este artigo? Esta ação não pode ser desfeita.')) {
                return;
            }
            
            const button = event.target;
            button.classList.add('loading');
            button.disabled = true;
            
            articlesRef.child(articleId).remove().then(() => {
                showToast('Artigo excluído com sucesso!', 'success');
                loadArticlesTable();
                loadDashboard();
            }).catch(error => {
                console.error('Error deleting article:', error);
                showToast('Erro ao excluir artigo!', 'error');
                button.classList.remove('loading');
                button.disabled = false;
            });
        }

        // Utility Functions
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        function formatDate(timestamp) {
            try {
                if (!timestamp) return 'Data inválida';
                const date = new Date(timestamp);
                return date.toLocaleDateString('pt-BR', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch (error) {
                return 'Data inválida';
            }
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function getCategoryName(category) {
            const categories = {
                breaking: 'Breaking News',
                critica: 'Crítica',
                mundo: 'Mundo',
                politica: 'Política',
                Entrevista: 'Entrevista',
                edicaoAN: 'Edição AN',
                entretenimento: 'Entretenimento'
            };
            return categories[category] || category || 'Geral';
        }

        // Enhanced error handling for network issues
        function handleNetworkError(error) {
            console.error('Network error:', error);
            
            if (!navigator.onLine) {
                showToast('Sem conexão com a internet!', 'error');
                return;
            }
            
            showToast('Erro de conexão. Tente novamente.', 'error');
        }

        // Initialize app with better error handling
        function initializeApp() {
            try {
                // Check if Firebase is properly initialized
                if (!firebase.apps.length) {
                    throw new Error('Firebase não foi inicializado corretamente');
                }

                // Test database connection
                database.ref('.info/connected').on('value', (snapshot) => {
                    const connected = snapshot.val();
                    if (!connected) {
                        showToast('Conexão perdida com o banco de dados', 'warning');
                    }
                });

                // Add keyboard shortcuts
                document.addEventListener('keydown', handleKeyboardShortcuts);
                
                // Add form auto-save for drafts (every 30 seconds)
                setInterval(autoSaveDraft, 30000);
                
                // Handle window resize for mobile menu
                window.addEventListener('resize', handleResize);
                
                // Handle offline/online events
                window.addEventListener('offline', () => {
                    showToast('Você está offline. Algumas funcionalidades podem não funcionar.', 'warning');
                });
                
                window.addEventListener('online', () => {
                    showToast('Conexão restaurada!', 'success');
                });

                console.log('App initialized successfully');
            } catch (error) {
                console.error('Error initializing app:', error);
                showToast('Erro ao inicializar aplicação!', 'error');
            }
        }

        function handleKeyboardShortcuts(event) {
            // Ctrl/Cmd + S to save article
            if ((event.ctrlKey || event.metaKey) && event.key === 's') {
                event.preventDefault();
                
                const currentSection = document.querySelector('.section:not(.hidden)');
                if (currentSection && currentSection.id === 'editor-section') {
                    saveArticle();
                }
            }
            
            // Esc to close mobile menu
            if (event.key === 'Escape') {
                closeMobileMenu();
            }
        }

        function handleResize() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            
            // Close mobile menu on resize to desktop
            if (window.innerWidth > 768) {
                sidebar.classList.remove('show');
                overlay.classList.remove('show');
                document.body.style.overflow = '';
            }
        }

        function autoSaveDraft() {
            try {
                const currentSection = document.querySelector('.section:not(.hidden)');
                if (!currentSection || currentSection.id !== 'editor-section') {
                    return;
                }
                
                const title = document.getElementById('article-title').value.trim();
                const content = quillEditor ? quillEditor.getText().trim() : '';
                
                if (!title && !content) {
                    return;
                }
                
                // Save to localStorage as backup
                const draftData = {
                    title: title,
                    summary: document.getElementById('article-summary').value.trim(),
                    content: quillEditor ? quillEditor.root.innerHTML : '',
                    youtubeUrl: document.getElementById('article-youtube-url').value.trim(),
                    category: document.getElementById('article-category').value,
                    author: document.getElementById('article-author').value.trim(),
                    timestamp: Date.now()
                };
                
                try {
                    localStorage.setItem('armindo-news-draft', JSON.stringify(draftData));
                } catch (e) {
                    // localStorage might be full or disabled
                    console.warn('Could not save draft to localStorage:', e);
                }
            } catch (error) {
                console.error('Error in auto-save:', error);
            }
        }

        function loadDraft() {
            try {
                const saved = localStorage.getItem('armindo-news-draft');
                if (!saved) return false;
                
                const draft = JSON.parse(saved);
                const age = Date.now() - draft.timestamp;
                
                // Only load drafts less than 24 hours old
                if (age > 24 * 60 * 60 * 1000) {
                    localStorage.removeItem('armindo-news-draft');
                    return false;
                }
                
                if (confirm('Foi encontrado um rascunho salvo automaticamente. Deseja carregá-lo?')) {
                    document.getElementById('article-title').value = draft.title || '';
                    document.getElementById('article-summary').value = draft.summary || '';
                    document.getElementById('article-youtube-url').value = draft.youtubeUrl || '';
                    document.getElementById('article-category').value = draft.category || 'breaking';
                    document.getElementById('article-author').value = draft.author || 'Admin';
                    
                    if (draft.youtubeUrl) {
                        previewYouTubeEmbed();
                    }
                    
                    if (quillEditor && draft.content) {
                        quillEditor.root.innerHTML = draft.content;
                    }
                    
                    localStorage.removeItem('armindo-news-draft');
                    showToast('Rascunho carregado!', 'success');
                    return true;
                }
            } catch (error) {
                console.error('Error loading draft:', error);
                localStorage.removeItem('armindo-news-draft');
            }
            
            return false;
        }

        // Enhanced form validation with real-time feedback
        function setupFormValidation() {
            const titleInput = document.getElementById('article-title');
            const summaryTextarea = document.getElementById('article-summary');
            
            if (titleInput) {
                titleInput.addEventListener('input', (e) => {
                    const length = e.target.value.length;
                    const maxLength = parseInt(e.target.getAttribute('maxlength'));
                    
                    if (length > maxLength * 0.9) {
                        e.target.style.borderColor = 'var(--warning)';
                    } else {
                        e.target.style.borderColor = '';
                    }
                });
            }
            
            if (summaryTextarea) {
                summaryTextarea.addEventListener('input', (e) => {
                    const length = e.target.value.length;
                    const maxLength = parseInt(e.target.getAttribute('maxlength'));
                    
                    // Add character counter
                    let counter = e.target.parentNode.querySelector('.char-counter');
                    if (!counter) {
                        counter = document.createElement('div');
                        counter.className = 'char-counter';
                        counter.style.cssText = 'text-align: right; font-size: 0.8rem; color: var(--gray); margin-top: 0.5rem;';
                        e.target.parentNode.appendChild(counter);
                    }
                    
                    counter.textContent = `${length}/${maxLength}`;
                    
                    if (length > maxLength * 0.9) {
                        counter.style.color = 'var(--warning)';
                        e.target.style.borderColor = 'var(--warning)';
                    } else {
                        counter.style.color = 'var(--gray)';
                        e.target.style.borderColor = '';
                    }
                });
            }
        }

        // Performance optimization: Lazy load images
        function setupLazyLoading() {
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src;
                            img.classList.remove('lazy');
                            observer.unobserve(img);
                        }
                    });
                });

                document.querySelectorAll('img[data-src]').forEach(img => {
                    imageObserver.observe(img);
                });
            }
        }

        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            try {
                initializeApp();
                setupFormValidation();
                
                // Login on Enter key
                const passwordInput = document.getElementById('admin-password');
                if (passwordInput) {
                    passwordInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            login();
                        }
                    });
                }

                // Load draft when entering editor (only if not editing existing article)
                const originalShowSection = showSection;
                window.showSection = function(sectionName) {
                    originalShowSection.call(this, sectionName);
                    
                    if (sectionName === 'editor' && !document.getElementById('edit-id').value) {
                        setTimeout(() => {
                            loadDraft();
                        }, 500);
                    }
                };

                // Add touch events for better mobile experience
                if ('ontouchstart' in window) {
                    document.body.classList.add('touch-device');
                }

                // Prevent form submission on Enter (except in textareas)
                document.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA' && e.target.tagName !== 'BUTTON') {
                        if (e.target.form && !e.target.classList.contains('allow-enter')) {
                            e.preventDefault();
                        }
                    }
                });

                console.log('DOM initialization complete');
            } catch (error) {
                console.error('Error during DOM initialization:', error);
                showToast('Erro ao carregar aplicação!', 'error');
            }
        });

        // Service Worker registration for offline support (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Global error handler
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            showToast('Erro inesperado na aplicação!', 'error');
        });

        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            handleNetworkError(event.reason);
            event.preventDefault();
        });

    </script>
</body>

</html>

